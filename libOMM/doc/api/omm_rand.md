# Overview

The `omm_rand` module provides basic pseudo-random number generation capabilities for the libOMM library. This functionality is primarily utilized for the initial generation of wavefunction (WF) coefficients when an explicit initial guess is not provided by the calling program. The module includes a function to produce an initial seed, which can be either time-dependent or fixed for reproducibility, and a subroutine implementing a Linear Congruential Generator (LCG) to produce a sequence of random numbers.

# Key Components

*   **Module `omm_rand`**:
    *   **Function `omm_rand_seed() RESULT(seed)`**:
        *   **Purpose**: Generates an integer value suitable for seeding the pseudo-random number generator.
        *   **Output**:
            *   `seed`: An `INTEGER` value.
        *   **Method**:
            *   **Reproducible Seed (if `NORAND` is defined)**: If the preprocessor macro `NORAND` is defined at compile time, this function returns a hardcoded, fixed integer seed (123456). This allows for deterministic and reproducible sequences of "random" numbers, which is highly beneficial for debugging and testing.
            *   **Time-Based Seed (default)**: If `NORAND` is not defined, the function attempts to generate a seed from the current system time. It calls the Fortran intrinsic `DATE_AND_TIME` to get the time as a character string (e.g., "HHMMSS.mmm"), reads this string as a real number, and then converts this number to an integer by scaling it (multiplying by 1000.0). This provides a simple way to get a different seed for different program runs.
    *   **Subroutine `omm_bsd_lcg(x, r)`**:
        *   **Purpose**: Generates a single pseudo-random number `r` in the range [0.0, 1.0) using a Linear Congruential Generator with parameters commonly found in BSD C libraries.
        *   **Input/Output**:
            *   `x`: An `INTEGER`, passed with `INTENT(INOUT)`. This is the current seed value. The subroutine updates `x` to the next value in the LCG sequence, so the caller should use the updated `x` for subsequent calls to get the next random number.
        *   **Output**:
            *   `r`: A `REAL(dp)`, passed with `INTENT(OUT)`. This is the generated pseudo-random number, scaled to be within the interval [0.0, 1.0).
        *   **Method**: The subroutine implements the LCG recurrence relation:
            `x_{n+1} = (a * x_n + c) MOD m`
            The generated random number `r` is then `x_{n+1} / m`.
            The parameters used are:
            *   `a = 1103515245_i64` (multiplier)
            *   `c = 12345` (increment)
            *   `m = 2^31` (modulus)
            Intermediate calculations for `a*x+c` are performed using `INTEGER(i64)` (64-bit integer kind from `omm_params`) to prevent overflow before the modulo operation, as `a*x` could exceed the range of a 32-bit integer if `x` is large.

# Important Variables/Constants

*   **`NORAND`**: A preprocessor macro. Its definition at compile time dictates whether `omm_rand_seed` produces a fixed seed or a time-dependent one.
*   **LCG Parameters in `omm_bsd_lcg`**:
    *   `a`: The multiplier (1103515245).
    *   `c`: The increment (12345).
    *   `m`: The modulus (2^31). These are standard parameters for one variant of LCGs.

# Usage Examples

The routines in `omm_rand` are primarily intended for internal use within libOMM, for instance, in the `omm` or `omm_callback` subroutines to initialize the wavefunction coefficient matrix `C_min` when no initial guess is provided.

```fortran
! Conceptual example of how these routines might be used:
USE omm_rand
USE omm_params, ONLY: dp ! For dp precision

INTEGER :: current_seed
REAL(dp) :: random_number_value
INTEGER :: i

! 1. Obtain an initial seed
current_seed = omm_rand_seed()

! 2. Generate a sequence of random numbers
PRINT *, "Generating 5 random numbers:"
DO i = 1, 5
  CALL omm_bsd_lcg(current_seed, random_number_value)
  PRINT *, "Random value ", i, ": ", random_number_value, " (New seed: ", current_seed, ")"
END DO
```

# Dependencies and Interactions

*   **`omm_params`**: The module `omm_rand` uses `dp` (double precision kind) and `i64` (64-bit integer kind) imported from `omm_params`.
*   **Fortran Intrinsic `DATE_AND_TIME`**: This intrinsic subroutine is called by `omm_rand_seed` to fetch the system date and time when the `NORAND` macro is not defined.
*   **Fortran Intrinsic `MOD`**: This intrinsic function is used in `omm_bsd_lcg` to perform the modulo operation.
*   **Fortran Intrinsic `INT` and `REAL`**: Used for type conversions.
*   The quality of the random numbers generated by `omm_bsd_lcg` is that of a standard LCG. While generally sufficient for tasks like initializing matrices to break symmetry, it may not be suitable for applications requiring high-quality statistical randomness (e.g., Monte Carlo simulations).
*   The `NORAND` preprocessor macro is a simple mechanism to switch between reproducible (fixed-seed) and variable (time-seeded) random number generation, which is valuable for debugging and testing phases.
